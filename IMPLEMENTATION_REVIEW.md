# –ê–Ω–∞–ª–∏–∑ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Court Registry MCP Server

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ MCP Server (`mcp_server.py`) - –æ—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è LLM
- ‚úÖ REST API Server (`api_server.py`) - HTTP endpoints
- ‚úÖ Database Models (`models.py`) - –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏ SQLAlchemy
- ‚úÖ Database Schema (`init_db.sql`) - —Å—Ö–µ–º–∞ –ë–î —Å pgvector
- ‚úÖ Configuration (`config.py`) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- ‚úÖ Database Connection (`database.py`) - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
- ‚úÖ Main Entry Point (`main.py`) - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
- ‚úÖ Docker Compose - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ Requirements - –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### 2. MCP Tools (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã)
- ‚úÖ `find_cases` - –ø–æ–∏—Å–∫ –¥–µ–ª –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
- ‚úÖ `search_similar_cases` - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
- ‚úÖ `get_case_details` - –¥–µ—Ç–∞–ª–∏ –¥–µ–ª–∞
- ‚úÖ `get_document` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å —Å–µ–∫—Ü–∏—è–º–∏
- ‚úÖ `analyze_judge_patterns` - –∞–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ —Å—É–¥–µ–π

### 3. Database Models (—á–∞—Å—Ç–∏—á–Ω–æ)
- ‚úÖ Court, Judge, Case
- ‚úÖ Document, DocumentVersion
- ‚úÖ Party, CaseParty
- ‚úÖ LawArticle, DocumentLawRef
- ‚úÖ Claim, DecisionOutcome
- ‚úÖ DocumentSection, EmbeddingChunk, EmbeddingEntityLink

---

## ‚ùå –ß—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–∫—Ä–∏—Ç–∏—á–Ω–æ)

### 1. Services Directory (–ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)

**–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ñ–∞–π–ª—ã:**
- ‚ùå `services/__init__.py`
- ‚ùå `services/change_monitor.py` - ChangeMonitor
- ‚ùå `services/fetcher.py` - FetcherPool
- ‚ùå `services/parser.py` - Parser
- ‚ùå `services/embeddings.py` - EmbeddingService

**–ü—Ä–æ–±–ª–µ–º–∞:** `main.py` –∏ `mcp_server.py` –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç —ç—Ç–∏ —Å–µ—Ä–≤–∏—Å—ã, –Ω–æ –æ–Ω–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç.

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ Database Models

–í `models.py` –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –º–æ–¥–µ–ª–∏ –∏–∑ —Å—Ö–µ–º—ã:
- ‚ùå `CaseRelation` - —Å–≤—è–∑–∏ –º–µ–∂–¥—É –¥–µ–ª–∞–º–∏ (–∞–ø–µ–ª–ª—è—Ü–∏–∏)
- ‚ùå `DocumentRelation` - —Å–≤—è–∑–∏ –º–µ–∂–¥—É –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
- ‚ùå `ParseRun` - –∏—Å—Ç–æ—Ä–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞
- ‚ùå `EntityMention` - —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç–µ–π
- ‚ùå `SearchIndex` - –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–∏—Å–∫–∞

### 3. Kafka Integration (–∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è)

**–û–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç:**
- ‚ùå Kafka topic `court.documents.discovered`
- ‚ùå Event schema –¥–ª—è discovery events
- ‚ùå Producer –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** Kafka –Ω–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –≤ –∫–æ–¥–µ.

### 4. Storage Service

**–û–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç:**
- ‚ùå S3 –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è raw files
- ‚ùå –ü—É—Ç—å: `s3://court-registry-raw/{doc_id}/{timestamp}.{html|pdf}`
- ‚ùå –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –¢–æ–ª—å–∫–æ –ø–æ–ª–µ `raw_storage_path` –≤ –º–æ–¥–µ–ª–∏, –Ω–æ –Ω–µ—Ç —Å–µ—Ä–≤–∏—Å–∞.

### 5. Reconciliation Loop

**–û–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç:**
- ‚ùå –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ hash
- ‚ùå Re-fetch –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚ùå –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏–π

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –¢–æ–ª—å–∫–æ discovery loop, reconciliation –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.

### 6. Dockerfile

**–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:**
- ‚ùå `Dockerfile` –¥–ª—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** `docker-compose.yml` —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ `build: .`, –Ω–æ Dockerfile –Ω–µ—Ç.

---

## ‚ö†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å/–ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å

### 1. MCP Server - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º—ã –≤ `mcp_server.py`:**

1. **–ò–º–ø–æ—Ä—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞:**
   ```python
   from services.embeddings import EmbeddingService  # ‚ùå –§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
   ```

2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫:**
   - –ù–µ—Ç try-catch –≤ async —Ñ—É–Ω–∫—Ü–∏—è—Ö
   - –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫

3. **–ù–µ–ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `find_cases`:**
   - JOIN'—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã
   - –ù–µ—Ç DISTINCT
   - –ù–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

4. **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫:**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç raw SQL –≤–º–µ—Å—Ç–æ ORM
   - –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è pgvector extension
   - –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ embeddings –Ω–µ –Ω–∞–π–¥–µ–Ω—ã

### 2. Database Models - –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è

**–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**

1. **CaseRelation:**
   ```python
   class CaseRelation(Base):
       parent_case_id = Column(UUID, ForeignKey("cases.id"), primary_key=True)
       child_case_id = Column(UUID, ForeignKey("cases.id"), primary_key=True)
       relation_type = Column(String(50))
   ```

2. **DocumentRelation:**
   ```python
   class DocumentRelation(Base):
       parent_document_version_id = Column(UUID, ForeignKey("document_versions.id"), primary_key=True)
       child_document_version_id = Column(UUID, ForeignKey("document_versions.id"), primary_key=True)
       relation_type = Column(String(50))
   ```

3. **ParseRun:**
   ```python
   class ParseRun(Base):
       id = Column(UUID, primary_key=True)
       document_version_id = Column(UUID, ForeignKey("document_versions.id"))
       parser_version = Column(String(50))
       parsed_at = Column(DateTime)
       confidence_score = Column(DECIMAL(5, 4))
   ```

4. **EntityMention:**
   ```python
   class EntityMention(Base):
       id = Column(UUID, primary_key=True)
       document_version_id = Column(UUID, ForeignKey("document_versions.id"))
       entity_type = Column(String(100))
       entity_id = Column(UUID)
       text_span = Column(Text)
   ```

5. **SearchIndex:**
   ```python
   class SearchIndex(Base):
       entity_type = Column(String(100), primary_key=True)
       entity_id = Column(UUID, primary_key=True)
       text_vector = Column(Vector(1536))
   ```

### 3. API Server - —É–ª—É—á—à–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º—ã:**

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
   - –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç
   - –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ UUID
   - –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ limit

2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:**
   - –ù–µ—Ç OpenAPI —Å—Ö–µ–º –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ù–µ—Ç –ø—Ä–∏–º–µ—Ä–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
   - –û–±—â–∏–µ HTTPException –±–µ–∑ –¥–µ—Ç–∞–ª–µ–π
   - –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

### 4. Configuration - –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è

**–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**

1. **Kafka:**
   ```python
   kafka_bootstrap_servers: str = "localhost:9092"
   kafka_topic_discovered: str = "court.documents.discovered"
   ```

2. **Storage:**
   ```python
   # –£–∂–µ –µ—Å—Ç—å, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
   ```

3. **Reconciliation:**
   ```python
   reconciliation_interval_hours: int = 24  # ‚úÖ –ï—Å—Ç—å
   ```

### 5. Main.py - –ø—Ä–æ–±–ª–µ–º—ã

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**

1. **–ò–º–ø–æ—Ä—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:**
   ```python
   from services.change_monitor import ChangeMonitor  # ‚ùå
   from services.fetcher import FetcherPool  # ‚ùå
   ```

2. **–ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î**

3. **–ü—Ä–æ—Ü–µ—Å—Å—ã –Ω–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è**

---

## üìã –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã)

### –ö—Ä–∏—Ç–∏—á–Ω–æ (–±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫)

1. **–°–æ–∑–¥–∞—Ç—å Services Directory:**
   - `services/change_monitor.py` - ChangeMonitor
   - `services/fetcher.py` - FetcherPool  
   - `services/parser.py` - Parser
   - `services/embeddings.py` - EmbeddingService

2. **–°–æ–∑–¥–∞—Ç—å Dockerfile**

3. **–î–æ–±–∞–≤–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏ –≤ `models.py`**

4. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ `main.py` –∏ `mcp_server.py`**

### –í–∞–∂–Ω–æ (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)

5. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Storage Service** (S3 –∏–ª–∏ local)

6. **–î–æ–±–∞–≤–∏—Ç—å Reconciliation Loop**

7. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫** –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö

8. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é** –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)

9. **Kafka Integration** (–∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ Redis Queue)

10. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã**

11. **–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

12. **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏**

---

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. ChangeMonitor Service

**–î–æ–ª–∂–µ–Ω:**
- –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å `reyestr.court.gov.ua` –∫–∞–∂–¥—ã–µ 5-15 –º–∏–Ω—É—Ç
- –û–±–Ω–∞—Ä—É–∂–∏–≤–∞—Ç—å –Ω–æ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- –û–±–Ω–∞—Ä—É–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è (–ø–æ hash)
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–±—ã—Ç–∏—è –≤ Kafka (–∏–ª–∏ Redis Queue)

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
class ChangeMonitor:
    async def discover_documents(self, db: Session) -> List[Dict]:
        # 1. –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–∑ —Ä–µ–µ—Å—Ç—Ä–∞
        # 2. –°—Ä–∞–≤–Ω–∏—Ç—å —Å –ë–î
        # 3. –í–µ—Ä–Ω—É—Ç—å –Ω–æ–≤—ã–µ/–∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ
        pass
```

### 2. FetcherPool Service

**–î–æ–ª–∂–µ–Ω:**
- 5-20 concurrent workers
- Retry logic (3 –ø–æ–ø—ã—Ç–∫–∏)
- Checksum validation
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ storage

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
class FetcherPool:
    async def fetch_document(self, url: str) -> bytes:
        # 1. HTTP –∑–∞–ø—Ä–æ—Å —Å retry
        # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ checksum
        # 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ storage
        pass
```

### 3. Parser Service

**–î–æ–ª–∂–µ–Ω:**
- –ü–∞—Ä—Å–∏—Ç—å HTML/PDF
- –ò–∑–≤–ª–µ–∫–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –°–æ–∑–¥–∞–≤–∞—Ç—å DocumentSection
- –ë—ã—Ç—å –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
class Parser:
    def parse(self, raw_content: bytes, doc_type: str) -> Dict:
        # 1. –ü–∞—Ä—Å–∏–Ω–≥ HTML/PDF
        # 2. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
        # 3. –°–æ–∑–¥–∞–Ω–∏–µ sections
        # 4. –í–æ–∑–≤—Ä–∞—Ç structured JSON
        pass
```

### 4. EmbeddingService

**–î–æ–ª–∂–µ–Ω:**
- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å embeddings —á–µ—Ä–µ–∑ OpenAI API
- –†–∞–∑–±–∏–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ chunks
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ EmbeddingChunk
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–∞—Ç—á–∏

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
class EmbeddingService:
    async def generate_embeddings(self, texts: List[str]) -> List[List[float]]:
        # 1. –í—ã–∑–æ–≤ OpenAI API
        # 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞—Ç—á–µ–π
        # 3. –í–æ–∑–≤—Ä–∞—Ç –≤–µ–∫—Ç–æ—Ä–æ–≤
        pass
```

### 5. Storage Service

**–î–æ–ª–∂–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å:**
- –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–¥–ª—è dev)
- S3 (–¥–ª—è production)
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- –ü—É—Ç—å: `{storage_type}://{doc_id}/{timestamp}.{ext}`

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
class StorageService:
    def save(self, doc_id: str, content: bytes, ext: str) -> str:
        # 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—É—Ç–∏
        # 2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
        # 3. –í–æ–∑–≤—Ä–∞—Ç –ø—É—Ç–∏
        pass
```

---

## üìä –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ–ø–∏—Å–∞–Ω–∏—é

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|-----------|----------|------------|--------|
| Change Monitor | –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | –ö—Ä–∏—Ç–∏—á–Ω–æ |
| Fetcher Pool | –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | –ö—Ä–∏—Ç–∏—á–Ω–æ |
| Parser | –ü–∞—Ä—Å–∏–Ω–≥ HTML/PDF | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | –ö—Ä–∏—Ç–∏—á–Ω–æ |
| Canonical DB | PostgreSQL —Å—Ö–µ–º–∞ | ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ | –ù—É–∂–Ω—ã –º–æ–¥–µ–ª–∏ |
| Legal Graph | –°–≤—è–∑–∏ –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏ | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | –ù–µ—Ç CaseRelation |
| MCP Query API | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è LLM | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | –†–∞–±–æ—Ç–∞–µ—Ç |
| Embeddings | RAG —Å–ª–æ–π | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | –ù–µ—Ç —Å–µ—Ä–≤–∏—Å–∞ |
| Versioning | –í–µ—Ä—Å–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | –†–∞–±–æ—Ç–∞–µ—Ç |
| Storage | S3/Local | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | –ö—Ä–∏—Ç–∏—á–Ω–æ |
| Kafka | Event streaming | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ |

---

## üéØ –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (–¥–ª—è –∑–∞–ø—É—Å–∫–∞):

1. –°–æ–∑–¥–∞—Ç—å `services/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å 4 —Å–µ—Ä–≤–∏—Å–∞–º–∏
2. –°–æ–∑–¥–∞—Ç—å `Dockerfile`
3. –î–æ–±–∞–≤–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏
4. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã

### –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è:

5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Storage Service
6. –î–æ–±–∞–≤–∏—Ç—å Reconciliation Loop
7. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
8. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é

### –í –±—É–¥—É—â–µ–º:

9. Kafka –∏–ª–∏ Redis Queue –¥–ª—è —Å–æ–±—ã—Ç–∏–π
10. –¢–µ—Å—Ç—ã (unit + integration)
11. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus/Grafana)
12. CI/CD pipeline

---

## üí° –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –í–º–µ—Å—Ç–æ Kafka:
- **Redis Streams** - –ø—Ä–æ—â–µ, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –Ω–∞—á–∞–ª–∞
- **PostgreSQL LISTEN/NOTIFY** - –≤—Å—Ç—Ä–æ–µ–Ω–æ –≤ –ë–î
- **Celery** - —É–∂–µ –≤ requirements.txt

### –í–º–µ—Å—Ç–æ S3 (–¥–ª—è –Ω–∞—á–∞–ª–∞):
- **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** - –ø—Ä–æ—â–µ –¥–ª—è dev
- **MinIO** - S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ª–æ–∫–∞–ª—å–Ω–æ

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** ~40% —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- MCP Server API
- REST API
- Database Models (–æ—Å–Ω–æ–≤–Ω—ã–µ)
- Database Schema

**–ß—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç:**
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Services (4 —Ñ–∞–π–ª–∞)
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Dockerfile
- –ù–µ–ø–æ–ª–Ω—ã–µ –º–æ–¥–µ–ª–∏

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ MVP:** 2-3 –¥–Ω—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** 1-2 –Ω–µ–¥–µ–ª–∏
